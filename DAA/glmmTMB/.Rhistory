library(BiocManager)
library(vegan)
library(plyr)
library(dplyr)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(ggtext)
library(reshape)
library(ggpubr)
library(car)
library(agricolae)
library(multcompView)
library(grid)
library(gridExtra)
library(sjmisc)
library(sjPlot)
library(MASS)
library(FSA)
library(rcompanion)
library(onewaytests)
library(ggsignif)
library(PerformanceAnalytics)
library(gvlma)
library(ggpmisc)
library(tibble)
library(fitdistrplus)
library(lme4)
library(nlme)
library(ape)
library(phyloseq)
library(colorRamp2)
#BiocManager::install("ComplexHeatmap")
library(ComplexHeatmap)
# read the log2fold ratio d
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
rr.comp <- read.csv("3genes.RR.csv", row.names = 1)
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
rr.comp <- read.csv("3genes.RR.csv", row.names = 1)
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
rr.comp <- read.csv("3genes.bulk.RR.csv", row.names = 1)
names(rr.comp)=str_sub(names(rr.comp),4)
#Set annotation
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
ann.comp <- read.csv("3genes.anno.csv", row.names = 1)
#order rownames
rr.comp.ord <- rr.comp[rownames(ann.comp), ]
#relative abund of bulk soil
# calculate relative abundance
aob.asv.ra <- transform_sample_counts(aob.rare.1282.seq, function(x) x/sum(x))
library(phyloseq)
# SET THE WORKING DIRECTORY
#setwd('/Users/arifinabintarti/Documents/France/microservices/070623_AOB_out/AOB.ASV-analysis')
setwd('D:/Fina/INRAE_Project/microservices/070623_AOB_out/AOB.ASV-analysis')
wd <- print(getwd())
# load the asv table
aob.asv <- read.table('annotated.AOB.ASVs.counts.tsv', sep='\t', header=T, row.names = 1, check.names = FALSE)
setwd('D:/Fina/INRAE_Project/microservices/070623_AOB_out')
aob.asv
dim(aob.asv)# 1338  192
sort(colSums(aob.asv, na.rm = FALSE, dims = 1), decreasing = F) # there are no asv that does not exist in at least one sample.
# load the taxonomy table
#setwd('/Users/arifinabintarti/Documents/France/microservices/070623_AOB_out/')
setwd('D:/Fina/INRAE_Project/microservices/070623_AOB_out')
aob.tax <- read.csv("besthit.diamond.output.curateddb.AOB.ASVs.csv")
dim(aob.tax) # 1338
# load the metadata
#setwd('/Users/arifinabintarti/Documents/France/microservices/')
setwd('D:/Fina/INRAE_Project/microservices')
meta_micro <- read.csv("meta_microservices.csv")
# load phylogenetic tree (nwk file)
#setwd('/Users/arifinabintarti/Documents/France/microservices/070623_AOB_out/AOB.Phylogenetic-analysis/')
setwd('D:/Fina/INRAE_Project/microservices/070623_AOB_out/AOB.Phylogenetic-analysis')
aob.tre <- ape::read.tree("tree.AOB.nwk")
re_order <- match(rownames(meta_micro), colnames(aob.asv))
aob.asv.ord  <- aob.asv[ ,re_order]
aob.asv.physeq = otu_table(aob.asv.ord, taxa_are_rows = TRUE) # asv table
sample_names(aob.asv.physeq)
# adding "S" for sample names to avoid possible problem later on
sample_names(aob.asv.physeq) <- paste0("S", sample_names(aob.asv.physeq))
# phyloseq object of the taxonomy table
aob.tax <- column_to_rownames(aob.tax, var = "ASVid")
aob.tax.physeq = tax_table(as.matrix(aob.tax)) # taxonomy table
# phyloseq object of the metadata
str(meta_micro)
meta_micro$Date <- factor(meta_micro$Date, levels = c("4/28/22", "06/01/2022", "07/05/2022", "7/20/22", "9/13/22"),
labels = c("04-28-22", "06-01-22", "07-05-22", "07-20-22", "09-13-22"))
rownames(meta_micro) <- sample_names(aob.asv.physeq)
aob.meta.physeq <- sample_data(meta_micro)# meta data
sample_names(aob.meta.physeq)
# read the rooted tree
#setwd('/Users/arifinabintarti/Documents/France/microservices/070623_AOB_out/AOB-rooted-tree/')
setwd('D:/Fina/INRAE_Project/microservices/070623_AOB_out/AOB-rooted-tree/')
AOB_rooted_tree <- ape::read.tree("tree.nwk")
AOB_rooted_tree
# tree visualization
library("treeio")
library("ggtree")
p <- ggtree(AOB_rooted_tree, layout = "circular") +
geom_tiplab(size=3, color="purple")
p
# make phyloseq object
aob.physeq <- merge_phyloseq(aob.asv.physeq,aob.tax.physeq,aob.meta.physeq,AOB_rooted_tree)
aob.physeq
aob.asv.ord <- as.data.frame(otu_table(aob.physeq))
aob.asv.ord
#write.csv(aob.asv.ord, file = "aob.asv.ord.csv")
sample_data(aob.physeq)$SampleID <- paste0("S", sample_data(aob.physeq)$SampleID)
sample_data(aob.physeq)
#relative abund of bulk soil
# calculate relative abundance
aob.asv.ra <- transform_sample_counts(aob.rare.1282.seq, function(x) x/sum(x))
# ASV Table
sort(colSums(aob.asv, na.rm = FALSE, dims = 1), decreasing = F)
set.seed(333)
aob.rare.1282.seq <- rarefy_even_depth(aob.physeq, sample.size = 1282,
rngseed = 333, replace = FALSE, trimOTUs = TRUE, verbose = TRUE)
#relative abund of bulk soil
# calculate relative abundance
aob.asv.ra <- transform_sample_counts(aob.rare.1282.seq, function(x) x/sum(x))
aob.asv.ra
#aob.asv.ra.melt <- psmelt(aob.asv.ra)
aob.asv.ra.melt <- psmelt(aob.asv.ra) %>%
group_by(OTU) %>%
summarize(Mean = mean(Abundance)) %>%
arrange(-Mean)
aob.asv.ra.melt$ra.perc <- aob.asv.ra.melt$Mean*100
# aoa
aoa.asv.ra <- transform_sample_counts(aoa.rare.min.physeq, function(x) x/sum(x))
# SET THE WORKING DIRECTORY
setwd('/Users/arifinabintarti/Documents/France/microservices/030423_AOA_out/AOA.ASV-analysis')
setwd('D:/Fina/INRAE_Project/microservices/030423_AOA_out/AOA.ASV-analysis')
wd <- print(getwd())
# load the asv table
aoa.asv <- read.table('annotated.AOA.ASVs.counts.tsv', sep='\t', header=T, row.names = 1, check.names = FALSE)
dim(aoa.asv) # 646  192
sort(rowSums(aoa.asv, na.rm = FALSE, dims = 1), decreasing = F) # there are no asv that does not exist in at least one sample.
# load the taxonomy table
setwd('/Users/arifinabintarti/Documents/France/microservices/030423_AOA_out/')
setwd('D:/Fina/INRAE_Project/microservices/030423_AOA_out/')
aoa.tax <- read.table("besthit.diamond.output.curateddb.AOA.ASVs.edited.csv", sep = ';', header=T)
dim(aoa.tax) # 646
# load the metadata
setwd('/Users/arifinabintarti/Documents/France/microservices/')
setwd('D:/Fina/INRAE_Project/microservices/')
meta_micro <- read.csv("meta_microservices.csv")
# load phylogenetic tree (nwk file)
setwd('D:/Fina/INRAE_Project/microservices/030423_AOA_out/AOA-rooted-tree/')
AOA_rooted_tree <- ape::read.tree("tree.nwk")
AOA_rooted_tree
############################################################################
# rarefaction curve
set.seed(13)
rarecurve(t(aoa.asv), step=50, cex=0.5, lwd=2, ylab="ASV", label=F)
# re-order the rownames of the asv table to match the colnames of the metadata.
re_order <- match(rownames(meta_micro), colnames(aoa.asv))
aoa.asv.ord  <- aoa.asv[ ,re_order]
aoa.asv.physeq = otu_table(aoa.asv.ord, taxa_are_rows = TRUE) # asv table
sample_names(aoa.asv.physeq)
# adding "S" for sample names to avoid possible problem later on
sample_names(aoa.asv.physeq) <- paste0("S", sample_names(aoa.asv.physeq))
# phyloseq object of the taxonomy table
aoa.tax <- column_to_rownames(aoa.tax, var = "ASVid")
#row.names(aoa.tax) <- aoa.tax$ASVid
aoa.tax.physeq = tax_table(as.matrix(aoa.tax)) # taxonomy table
# phyloseq object of the metadata
meta_micro$Date <- factor(meta_micro$Date, levels = c("4/28/22", "06/01/2022", "07/05/2022", "7/20/22", "9/13/22"),
labels = c("04-28-22", "06-01-22", "07-05-22", "07-20-22", "09-13-22"))
rownames(meta_micro) <- sample_names(aoa.asv.physeq)
aoa.meta.physeq <- sample_data(meta_micro)# meta data
sample_names(aoa.meta.physeq)
# read the rooted tree
setwd('D:/Fina/INRAE_Project/microservices/030423_AOA_out/AOA-rooted-tree/')
AOA_rooted_tree <- ape::read.tree("tree.nwk")
# make phyloseq object
aoa.physeq <- merge_phyloseq(aoa.asv.physeq,aoa.tax.physeq,aoa.meta.physeq,AOA_rooted_tree)
aoa.physeq
sample_data(aoa.physeq)$SampleID <- paste0("S", sample_data(aoa.physeq)$SampleID)
sample_data(aoa.physeq)
# run the ggrare function attached in the file "generating_rarecurve.r"
aoa.rare <- ggrare(aoa.physeq, step = 1, color = "Type", label = "SampleID", se = FALSE)
set.seed(13)
aoa.rare.min.physeq <- rarefy_even_depth(aoa.physeq, sample.size = min(sample_sums(aoa.physeq)),
rngseed = 13, replace = FALSE, trimOTUs = TRUE, verbose = TRUE)
aoa.rare.min.physeq
sort(sample_sums(aoa.rare.min.physeq), decreasing = F) # 54 OTUs were removed because they are no longer present in any sample after random subsampling
# no sample removed
sort(rowSums(otu_table(aoa.rare.min.physeq), na.rm = FALSE, dims = 1), decreasing = F)
# SET THE WORKING DIRECTORY
setwd('/Users/arifinabintarti/Documents/France/microservices/090623_COM_out/COM.ASV-analysis')
setwd('D:/Fina/INRAE_Project/microservices/090623_COM_out/COM.ASV-analysis')
wd <- print(getwd())
# load the asv table
com.asv <- read.table('annotated.COM.ASVs.counts.tsv', sep='\t', header=T, row.names = 1, check.names = FALSE)
dim(com.asv) # 686 192
# remove the bad sample (sample # 26) from the OTU table
com.asv.sub <- com.asv[, -which(names(com.asv) == "26" )]
sort(rowSums(com.asv.sub, na.rm = FALSE, dims = 1), decreasing = FALSE)
dim(com.asv.sub)
# load the taxonomy table
setwd('/Users/arifinabintarti/Documents/France/microservices/090623_COM_out/')
setwd('D:/Fina/INRAE_Project/microservices/090623_COM_out/')
com.tax <- read.table("besthit.diamond.output.curateddb.COM.ASVs.edited.csv", sep = ';', header=T)
dim(com.tax) # 680
# load the metadata
setwd('/Users/arifinabintarti/Documents/France/microservices/')
setwd('D:/Fina/INRAE_Project/microservices/')
meta_micro <- read.csv("meta_microservices.csv")
# remove the bad sample (sample # 26) from the metadata
meta_micro_sub <- meta_micro[-26,]
# load phylogenetic tree (nwk file)
setwd('D:/Fina/INRAE_Project/microservices/090623_COM_out/COM-rooted-tree/')
COM_rooted_tree <- ape::read.tree("tree.nwk")
############################################################################
# rarefaction curve
set.seed(13)
re_order <- match(rownames(meta_micro_sub), colnames(com.asv.sub))
com.asv.ord  <- com.asv.sub[ ,re_order]
com.asv.physeq = otu_table(com.asv.ord, taxa_are_rows = TRUE) # asv table
sample_names(com.asv.physeq)
# adding "S" for sample names to avoid possible problem later on
sample_names(com.asv.physeq) <- paste0("S", sample_names(com.asv.physeq))
# phyloseq object of the taxonomy table
com.tax <- column_to_rownames(com.tax, var = "ASVid")
#row.names(com.tax) <- com.tax$ASVid
com.tax.physeq = tax_table(as.matrix(com.tax)) # taxonomy table
# phyloseq object of the metadata
meta_micro_sub$Date <- factor(meta_micro_sub$Date, levels = c("4/28/22", "06/01/2022", "07/05/2022", "7/20/22", "9/13/22"),
labels = c("04-28-22", "06-01-22", "07-05-22", "07-20-22", "09-13-22"))
rownames(meta_micro_sub) <- sample_names(com.asv.physeq)
com.meta.physeq <- sample_data(meta_micro_sub)# meta data
sample_names(com.meta.physeq)
# read the rooted tree
# read the rooted tree
setwd('D:/Fina/INRAE_Project/microservices/090623_COM_out/COM-rooted-tree/')
COM_rooted_tree <- ape::read.tree("tree.nwk")
# make phyloseq object
com.physeq <- merge_phyloseq(com.asv.physeq,com.tax.physeq,com.meta.physeq,COM_rooted_tree)
com.physeq # 653 taxa
sample_data(com.physeq)$SampleID <- paste0("S", sample_data(com.physeq)$SampleID)
sample_data(com.physeq)
set.seed(333)
com.rare.min.physeq <- rarefy_even_depth(com.physeq, sample.size = 5242,
rngseed = 333, replace = FALSE, trimOTUs = TRUE, verbose = TRUE)
com.rare.min.physeq #632 taxa
sort(sample_sums(com.rare.min.physeq), decreasing = F) # 21 OTUs wer
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
rr.comp <- read.csv("3genes.bulk.RR.csv", row.names = 1)
names(rr.comp)=str_sub(names(rr.comp),4)
#Set annotation
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
ann.comp <- read.csv("3genes.anno.csv", row.names = 1)
#order rownames
rr.comp.ord <- rr.comp[rownames(ann.comp), ]
#relative abund of bulk soil
# calculate relative abundance
aob.asv.ra <- transform_sample_counts(aob.rare.1282.seq, function(x) x/sum(x))
aob.asv.ra
#aob.asv.ra.melt <- psmelt(aob.asv.ra)
aob.asv.ra.melt <- psmelt(aob.asv.ra) %>%
group_by(OTU) %>%
summarize(Mean = mean(Abundance)) %>%
arrange(-Mean)
aob.asv.ra.melt$ra.perc <- aob.asv.ra.melt$Mean*100
aoa.asv.ra <- transform_sample_counts(aoa.rare.min.physeq, function(x) x/sum(x))
aoa.asv.ra
aoa.asv.ra.melt <- psmelt(aoa.asv.ra) %>%
group_by(OTU) %>%
summarize(Mean = mean(Abundance)) %>%
arrange(-Mean)
aoa.asv.ra.melt$ra.perc <- aoa.asv.ra.melt$Mean*100
# comammox
com.asv.ra <- transform_sample_counts(com.rare.min.physeq, function(x) x/sum(x))
com.asv.ra
com.asv.ra.melt <- psmelt(com.asv.ra) %>%
group_by(OTU) %>%
summarize(Mean = mean(Abundance)) %>%
arrange(-Mean)
com.asv.ra.melt$ra.perc <- com.asv.ra.melt$Mean*100
# save the results in the computer and read the csv file
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
RA.comp <- read.csv("3genes.ra.all.csv", row.names = 1)
RA.comp.ord <- RA.comp[match(rownames(ann.comp), rownames(RA.comp)), ]
#set colors
lgd1 <- Legend(labels = c("Nitrosolobus-multiformis-Nl1_2667636517",
"Nitrosomonas-communis-Nm44_2676397764",
"Nitrosospira-sp-17Nsp14_2671457573",
"Nitrosospira-sp_2630434854",
"Nitrosospira-sp_2636913388"),
legend_gp = gpar(fill=c("#990F0F","#FFB2B2","#2C85B2","#7EC3E5","#B2E5FF")),
title= "AOB")
lgd2 <- Legend(labels = c("Ca.Nitrosotaleales (NT-Alpha-1.1.2.2)",
"Nitrososphaerales (NS-Delta-1.Incertae_sedis)",
"Nitrososphaerales (NS-Gamma-1.2)",
"Nitrososphaerales (NS-Gamma-2.3.1)"),
legend_gp = gpar(fill=c("#B22C2C","#A3CC51","#E5FFB2","#B2E5FF")),
title= "AOA")
lgd3 <- Legend(labels = c("Clade B Nitrospira-sp.GGF-bin22",
"Clade B Nitrospira-sp.LM-bin98",
"Clade B Nitrospira-sp.LPPL-bin249"),
legend_gp = gpar(fill=c("#B26F2C","#CC8E51","#E5B17E")),
title= "COMAMMOX")
pd = packLegend(lgd1, lgd2, lgd3, direction = "vertical")
draw(pd)
col.comp.ord <- list("Taxonomy"=c("Nitrosolobus-multiformis-Nl1_2667636517"="#990F0F",
"Nitrosomonas-communis-Nm44_2676397764"="#FFB2B2",
"Nitrosospira-sp-17Nsp14_2671457573"="#2C85B2",
"Nitrosospira-sp_2630434854"="#7EC3E5",
"Nitrosospira-sp_2636913388"="#B2E5FF",
"Ca.Nitrosotaleales (NT-Alpha-1.1.2.2)"="#B22C2C",
"Nitrososphaerales (NS-Delta-1.Incertae_sedis)"="#A3CC51",
"Nitrososphaerales (NS-Gamma-1.2)"="#E5FFB2",
"Nitrososphaerales (NS-Gamma-2.3.1)"="#B2E5FF",
"Clade B Nitrospira-sp.GGF-bin22"="#B26F2C",
"Clade B Nitrospira-sp.LM-bin98"="#CC8E51",
"Clade B Nitrospira-sp.LPPL-bin249"="#E5B17E"))
col_level <- factor(ann.comp$Taxonomy, levels = c("Nitrosolobus-multiformis-Nl1_2667636517",
"Nitrosomonas-communis-Nm44_2676397764",
"Nitrosospira-sp-17Nsp14_2671457573",
"Nitrosospira-sp_2630434854",
"Nitrosospira-sp_2636913388",
"Ca.Nitrosotaleales (NT-Alpha-1.1.2.2)",
"Nitrososphaerales (NS-Delta-1.Incertae_sedis)",
"Nitrososphaerales (NS-Gamma-1.2)",
"Nitrososphaerales (NS-Gamma-2.3.1)",
"Clade B Nitrospira-sp.GGF-bin22",
"Clade B Nitrospira-sp.LM-bin98",
"Clade B Nitrospira-sp.LPPL-bin249"))
tax_level=levels(col_level)
colAnn.comp <- rowAnnotation(df=ann.comp,
col=col.comp.ord,
show_legend =F,
annotation_legend_param = list(Taxonomy = list(
title="Taxonomy",
ncol=3,
at = tax_level)),
annotation_width=unit(c(1, 4), "cm"),
gap=unit(1, "mm"))
colAnn.comp
bar.ann.comp <- rowAnnotation(RelativeAbundance = anno_barplot(RA.comp.ord,
gp = gpar(fill = c("#990F0F", "#990F0F","#990F0F","#990F0F","#990F0F",
"#FFB2B2","#2C85B2","#2C85B2","#2C85B2","#2C85B2",
"#7EC3E5","#B2E5FF","#B2E5FF","#B2E5FF","#B2E5FF",
"#B2E5FF","#B2E5FF","#B22C2C","#A3CC51","#A3CC51",
"#E5FFB2","#B2E5FF","#B26F2C","#B26F2C","#CC8E51",
"#E5B17E","#E5B17E","#E5B17E")),
ylim=c(0,0.18),
extend = 0.00000000000000001,
width  = unit(4, "cm"),
height = unit(6, "cm")))
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
ann.fert <- read.csv("BulkSoil.anno.csv", row.names = 1)
colours.fert <- list("Fertilization"=c("M"="#ffcf20FF",
"D"="#541352FF",
"K"="#2f9aa0FF"))
colFert.Ann <- columnAnnotation(df=ann.fert,
col=colours.fert,
show_legend =F,
show_annotation_name =F,
annotation_width=unit(c(1, 4), "cm"),
gap=unit(1, "mm"))
col_fun = colorRamp2(c(10, 0, -10), c("blue", "white", "red"))
#tax = Heatmap(as.matrix(ann), cluster_rows  = F)
row_split = rep("AOB", 17)
row_split[18:22] = "AOA"
row_split[23:28] = "COMAMMOX"
row_split.fa = factor(row_split, levels = c("AOB", "AOA", "COMAMMOX"))
comp.bs.hm <- Heatmap(as.matrix(rr.comp.ord),
name = "Log2-ratio",
column_title = "Bulk Soil",
cluster_rows  = F,
cluster_row_slices=F,
column_order = order(colnames(as.matrix(rr.comp.ord))),
row_split = row_split.fa,
left_annotation = bar.ann.comp,
bottom_annotation = colFert.Ann,
show_column_dend = F,
show_row_dend = F,
row_gap = unit(0.4, "cm"),
border_gp = gpar(col = "black", lty = 2),
col= col_fun)
comp.bs.hm
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
rr.rhizo.comp <- read.csv("3genes.rhizos.RR.csv", row.names = 1)
names(rr.rhizo.comp)=str_sub(names(rr.rhizo.comp),4)
#Set annotation
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
ann.comp <- read.csv("3genes.anno.csv", row.names = 1)
#order rownames
rr.rhizo.comp.ord <- rr.rhizo.comp[rownames(ann.comp), ]
colAnn.comp <- rowAnnotation(df=ann.comp,
col=col.comp.ord,
show_legend =F,
annotation_legend_param = list(Taxonomy = list(
title="Taxonomy",
ncol=3,
at = tax_level)),
annotation_width=unit(c(1, 4), "cm"),
gap=unit(1, "mm"))
setwd('D:/Fina/INRAE_Project/microservices/DAA/glmmTMB/')
ann.fert.rh <- read.csv("Rhizo.anno.csv", row.names = 1)
colours.fert <- list("Fertilization"=c("M"="#ffcf20FF",
"D"="#541352FF",
"K"="#2f9aa0FF"))
colFert.Ann.rh <- columnAnnotation(df=ann.fert.rh, col=colours.fert,
show_legend =F,
show_annotation_name =F,
annotation_width=unit(c(1, 4), "cm"),
gap=unit(1, "mm"))
col_fun = colorRamp2(c(10, 0, -10), c("blue", "white", "red"))
row_split = rep("AOB", 17)
row_split[18:22] = "AOA"
row_split[23:28] = "COMAMMOX"
row_split.fa = factor(row_split, levels = c("AOB", "AOA", "COMAMMOX"))
comp.rh.hm <- Heatmap(as.matrix(rr.rhizo.comp.ord),
name = "Log2-ratio",
column_title = "Rhizosphere",
cluster_rows  = F,
cluster_row_slices=F,
column_order = order(colnames(as.matrix(rr.rhizo.comp.ord))),
row_split = row_split.fa,
right_annotation = colAnn.comp,
bottom_annotation = colFert.Ann.rh,
show_column_dend = F,
show_row_dend = F,
row_gap = unit(0.4, "cm"),
border_gp = gpar(col = "black", lty = 2, width=3),
col= col_fun)
comp.rh.hm
comp.heat <- comp.bs.hm + comp.rh.hm
comp.heat2 <- draw(comp.heat,
ht_gap = unit(0.4, "cm"),
heatmap_legend_list=pd,
align_heatmap_legend="heatmap_top")
comp.bs.hm
comp.rh.hm
colFert.Ann.rh <- columnAnnotation(df=ann.fert.rh, col=colours.fert,
#show_legend =F,
show_annotation_name =F,
annotation_width=unit(c(1, 4), "cm"),
gap=unit(1, "mm"))
comp.rh.hm <- Heatmap(as.matrix(rr.rhizo.comp.ord),
name = "Log2-ratio",
column_title = "Rhizosphere",
cluster_rows  = F,
cluster_row_slices=F,
column_order = order(colnames(as.matrix(rr.rhizo.comp.ord))),
row_split = row_split.fa,
right_annotation = colAnn.comp,
bottom_annotation = colFert.Ann.rh,
show_column_dend = F,
show_row_dend = F,
row_gap = unit(0.4, "cm"),
border_gp = gpar(col = "black", lty = 2, width=3),
col= col_fun)
comp.rh.hm
colAnn.comp <- rowAnnotation(df=ann.comp,
col=col.comp.ord,
#show_legend =F,
annotation_legend_param = list(Taxonomy = list(
title="Taxonomy",
ncol=3,
at = tax_level)),
annotation_width=unit(c(1, 4), "cm"),
gap=unit(1, "mm"))
colFert.Ann.rh <- columnAnnotation(df=ann.fert.rh, col=colours.fert,
show_legend =F,
show_annotation_name =F,
annotation_width=unit(c(1, 4), "cm"),
gap=unit(1, "mm"))
comp.rh.hm <- Heatmap(as.matrix(rr.rhizo.comp.ord),
name = "Log2-ratio",
column_title = "Rhizosphere",
cluster_rows  = F,
cluster_row_slices=F,
column_order = order(colnames(as.matrix(rr.rhizo.comp.ord))),
row_split = row_split.fa,
right_annotation = colAnn.comp,
bottom_annotation = colFert.Ann.rh,
show_column_dend = F,
show_row_dend = F,
row_gap = unit(0.4, "cm"),
border_gp = gpar(col = "black", lty = 2, width=3),
col= col_fun)
comp.rh.hm
colAnn.comp <- rowAnnotation(df=ann.comp,
col=col.comp.ord,
#show_legend =F,
annotation_legend_param = list(Taxonomy = list(
title="Taxonomy",
ncol=1,
at = tax_level)),
annotation_width=unit(c(1, 4), "cm"),
gap=unit(1, "mm"))
comp.rh.hm
comp.rh.hm <- Heatmap(as.matrix(rr.rhizo.comp.ord),
name = "Log2-ratio",
column_title = "Rhizosphere",
cluster_rows  = F,
cluster_row_slices=F,
column_order = order(colnames(as.matrix(rr.rhizo.comp.ord))),
row_split = row_split.fa,
right_annotation = colAnn.comp,
bottom_annotation = colFert.Ann.rh,
show_column_dend = F,
show_row_dend = F,
row_gap = unit(0.4, "cm"),
border_gp = gpar(col = "black", lty = 2, width=3),
col= col_fun)
comp.rh.hm
str(tax_level)
tax_level
